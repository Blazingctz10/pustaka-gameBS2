{% extends "base.html" %}

{% block title %}{{ game.judul }} - Pustaka Game{% endblock %}

{% block content %}
    <p><a href="{% url 'home' %}">&larr; Kembali ke Katalog</a></p>
    <hr>

    <div class="game-info">
        {% if game.gambar_utama_url %}
            <img src="{{ game.gambar_utama_url }}" alt="Cover untuk {{ game.judul }}" width="100%" style="border-radius: 8px; margin-bottom: 20px;">
        {% endif %}

        <h1>{{ game.judul }}</h1>
        <p><strong>Developer:</strong> {{ game.developer }} | <strong>Versi:</strong> {{ game.versi }}</p>
        <hr>
        <h3>Deskripsi</h3>
        <p>{{ game.deskripsi|linebreaks }}</p>

        <div class="screenshots">
            <h3>Screenshot</h3>
            {% for ss in game.screenshots.all %}
                <a href="{{ ss.url_gambar }}" target="_blank">
                    <img class="screenshot-img" src="{{ ss.url_gambar }}" alt="{{ ss.caption|default:'Screenshot' }}">
                </a>
            {% empty %}
                <p>Tidak ada screenshot tersedia.</p>
            {% endfor %}
        </div>

        <div class="downloads">
            <h3>Link Download</h3>
            <ul>
            {% for link in game.download_links.all %}
                <li><a href="{{ link.url_link }}" target="_blank">{{ link.nama_link }}</a></li>
            {% empty %}
                <li>Tidak ada link download tersedia.</li>
            {% endfor %}
            </ul>
        </div>
    </div>

    <div class="add-comment-section">
        <h3>Tinggalkan Komentar</h3>
        {% if user.is_authenticated %}
            <form action="{% url 'add_comment' game.pk %}" method="post">
                {% csrf_token %}
                <textarea name="isi_komentar" rows="4" placeholder="Tulis komentar Anda di sini..." style="width: 100%; background-color: #333; color: #ddd; border: 1px solid #555; border-radius: 4px; padding: 10px;" required></textarea>
                <br>
                <button type="submit" style="margin-top: 10px; padding: 8px 15px; background-color: #569cd6; color: white; border: none; border-radius: 4px; cursor: pointer;">Kirim Komentar</button>
            </form>
        {% else %}
            <p>Anda harus <a href="{% url 'login' %}?next={{ request.path }}">login</a> untuk bisa berkomentar.</p>
        {% endif %}
    </div>

    <div class="comments-section">
        <h3>Komentar Pengguna ({{ game.komentars.all.count }})</h3>
        {% for komentar in game.komentars.all %}
          <div class="comment">
            <p>
              <strong>{{ komentar.pengguna.username }}</strong>
              <small style="color: #888;">pada {{ komentar.tanggal_dibuat|date:"d M Y, H:i" }}</small>
            </p>
            <p>{{ komentar.isi_komentar|linebreaks }}</p>
          </div>
        {% empty %}
          <p>Jadilah yang pertama berkomentar!</p>
        {% endfor %}
    </div>
{% endblock %}